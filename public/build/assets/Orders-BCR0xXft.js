import{_ as ue}from"./Card-cS3RJCXC.js";import{w as W,r as D,H as xe,a as Y,c as E,p as we,d as ee,k as w,f as e,g as u,t as p,b as I,e as g,h,j as k,i as c,s as be,o as ke,F,l as Z,u as r,v as _e}from"./app-Dpk2qVhs.js";import{u as Oe}from"./useToast-YFBE-blV.js";import{_ as me}from"./Button-D3HFYD0O.js";import{_ as $e}from"./SelectMenu-DERZyep-.js";import{_ as Ie}from"./Input-CzHuiSw4.js";import{_ as fe}from"./Icon-HLcQNufH.js";import{_ as pe}from"./Badge-Dj3YBdeK.js";import{_ as ge}from"./Empty-CZBQMVNA.js";import{_ as Se}from"./Skeleton-CZePq8uu.js";import{_ as Ce}from"./Modal-CeQOkZl5.js";import"./usePortal-CLMo3DUw.js";import"./Presence-Bdn01jZp.js";import"./VisuallyHidden-BJmj1zui.js";import"./PopperArrow-D2znCzMG.js";import"./utils-CWiJOLA-.js";import"./VisuallyHiddenInput-iJgpq9SD.js";import"./index-CZ7JqbuJ.js";import"./useLocale-CA26Ptc0.js";import"./DialogTrigger-Br19wQdd.js";function ze(t){const _=Object.values(t).find(d=>d!==void 0);return Array.isArray(_)?_[0]??"Request gagal.":_??"Request gagal."}function Ue(t){const _=Oe(),d=we(),v=D([]),U=D(1),S=D(null),C=D(!1),O=D(!1),z=D(null),$=D(null),a=D(!1),o=D(null);W(t.orders,s=>{const n=s.current_page??1,l=s.data??[];if(n<=1)v.value=[...l];else if(n>U.value){const b=new Set(v.value.map(L=>String(L.code))),j=l.filter(L=>!b.has(String(L.code)));v.value=[...v.value,...j]}U.value=n,S.value=s.next_page??null,C.value=!!s.has_more},{immediate:!0});const i=D(""),y=D("all"),P=D("newest"),M={pending:{label:"Menunggu",color:"warning",icon:"i-lucide-clock"},paid:{label:"Dibayar",color:"primary",icon:"i-lucide-badge-check"},processing:{label:"Diproses",color:"info",icon:"i-lucide-cog"},shipped:{label:"Dikirim",color:"info",icon:"i-lucide-truck"},delivered:{label:"Selesai",color:"success",icon:"i-lucide-check-circle-2"},cancelled:{label:"Dibatalkan",color:"neutral",icon:"i-lucide-x-circle"},refunded:{label:"Refund",color:"neutral",icon:"i-lucide-undo-2"}},N={unpaid:{label:"Belum bayar",color:"warning",icon:"i-lucide-alert-circle"},paid:{label:"Lunas",color:"success",icon:"i-lucide-credit-card"},refunded:{label:"Refund",color:"neutral",icon:"i-lucide-undo-2"},failed:{label:"Gagal",color:"error",icon:"i-lucide-ban"}},m=E(()=>[{label:"Semua status",value:"all"},...Object.entries(M).map(([s,n])=>({label:n.label,value:s}))]),T=[{label:"Terbaru",value:"newest"},{label:"Terlama",value:"oldest"},{label:"Total tertinggi",value:"highest"},{label:"Total terendah",value:"lowest"}],f=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(s),x=s=>{if(!s)return"-";const n=new Date(s);return Number.isNaN(n.getTime())?s:new Intl.DateTimeFormat("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(n)},q=E(()=>{const s=i.value.trim().toLowerCase();let n=[...v.value];return y.value!=="all"&&(n=n.filter(l=>l.status===y.value)),s&&(n=n.filter(l=>[l.code,String(l.id),l.customer?.name??"",l.customer?.email??"",l.tracking_number??""].join(" ").toLowerCase().includes(s))),n.sort((l,b)=>{const j=new Date(l.created_at).getTime(),L=new Date(b.created_at).getTime();return P.value==="newest"?L-j:P.value==="oldest"?j-L:P.value==="highest"?b.total-l.total:l.total-b.total}),n}),V=E(()=>t.orders.value.total??v.value.length),te=E(()=>q.value.length),ae=E(()=>o.value?(o.value.items?.length??0)>0?o.value.items??[]:o.value.items_preview??[]:[]);function se(){i.value="",y.value="all",P.value="newest"}function G(){O.value||!C.value||!S.value||(O.value=!0,Y.get("/dashboard",{section:"orders",orders_page:S.value},{only:["orders"],preserveState:!0,preserveScroll:!0,replace:!0,onFinish:()=>{O.value=!1}}))}function H(s){o.value={...s},a.value=!0}function J(){a.value=!1}W(a,s=>{s||(o.value=null)});function R(s){return["unpaid","failed"].includes(String(s.payment_status??""))||s.payment_status==null&&s.status==="pending"}function Q(s){const n=String(s.payment_method_code??"").trim().toLowerCase();return["p-001","midtrans"].includes(n)}function K(s){return R(s)&&Q(s)}function A(s){return!!s.paid_at}function ne(s){return`/dashboard/orders/${s.id}/invoice`}function ie(s){if(!A(s)){_?.add?.({title:"Invoice belum tersedia",description:"Invoice hanya dapat diunduh untuk pesanan yang sudah dibayar.",color:"warning",icon:"i-lucide-file-warning"});return}const n=ne(s);window.open(n,"_blank","noopener,noreferrer")||window.location.assign(n)}function le(){return`${t.midtrans.value.env==="production"?"https://app.midtrans.com":"https://app.sandbox.midtrans.com"}/snap/snap.js`}async function oe(){return window.snap?.pay?!0:t.midtrans.value.client_key?new Promise(s=>{const n=document.querySelector('script[data-midtrans-snap="1"]');if(n){n.addEventListener("load",()=>s(!!window.snap?.pay)),n.addEventListener("error",()=>s(!1));return}const l=document.createElement("script");l.src=le(),l.async=!0,l.setAttribute("data-midtrans-snap","1"),l.setAttribute("data-client-key",t.midtrans.value.client_key),l.onload=()=>s(!!window.snap?.pay),l.onerror=()=>s(!1),document.head.appendChild(l)}):!1}async function B(s,n={},l=["flash","errors"]){const b=String(d.props.csrf_token??"");return new Promise((j,L)=>{Y.post(s,{_token:b,...n},{only:l,preserveState:!0,preserveScroll:!0,replace:!0,onSuccess:ce=>{const he=ce?.props??{};j(he)},onError:ce=>{L(new Error(ze(ce)))},onCancel:()=>{L(new Error("Request dibatalkan."))}})})}function X(s){const n=String(s??"").trim();if(n==="")return null;if(n.startsWith("data:image/"))return n;if(n.startsWith("http://")||n.startsWith("https://"))try{const b=new URL(n),j=b.pathname.replace(/\/{2,}/g,"/");return j.startsWith("/storage/")?`${j}${b.search}`:n}catch{return n}const l=n.replace(/\/{2,}/g,"/");return l.startsWith("/storage/")||l.startsWith("/")?l:l.startsWith("public/storage/")?`/${l.slice(7)}`:l.startsWith("storage/")?`/${l}`:l.startsWith("public/")?`/storage/${l.slice(7)}`:`/storage/${l}`}function re(s){const n=s.shipping_address;return n?[n.address_line1,n.address_line2,n.district,n.city,n.province,n.postal_code,n.country].filter(l=>typeof l=="string"&&l.trim()!=="").join(", "):"-"}function de(s){v.value=v.value.map(n=>String(n.id)===String(s.id)?{...n,...s}:n),o.value&&String(o.value.id)===String(s.id)&&(o.value={...o.value,...s})}async function ye(s){if(z.value===null){z.value=String(s.id);try{const l=(await B(`/dashboard/orders/${s.id}/payment-status`,{},["flash","errors","orders"])).flash?.orders,b=l?.payload??{};b.order&&de(b.order),_?.add?.({title:"Status pembayaran diperbarui",description:l?.message??"Status terbaru berhasil dimuat.",color:"success",icon:"i-lucide-badge-check"})}catch(n){const l=n instanceof Error?n.message:"Gagal memeriksa status pembayaran.";_?.add?.({title:"Cek status gagal",description:l,color:"error",icon:"i-lucide-x-circle"})}finally{z.value=null}}}async function ve(s){if($.value===null&&K(s)){if(!t.midtrans.value.client_key){_?.add?.({title:"Midtrans belum aktif",description:"Client key Midtrans belum tersedia.",color:"error",icon:"i-lucide-x-circle"});return}$.value=String(s.id);try{a.value&&o.value&&String(o.value.id)===String(s.id)&&(a.value=!1,await xe());const l=(await B(`/dashboard/orders/${s.id}/pay-now`)).flash?.orders,b=l?.payload??{};if(b.redirectUrl){window.location.assign(b.redirectUrl);return}if(!b.snapToken)throw new Error(l?.message??"Token Midtrans tidak tersedia untuk order ini.");if(!await oe())throw new Error("Midtrans Snap gagal dimuat. Periksa konfigurasi client key.");$.value=null,window.snap?.pay(b.snapToken,{onSuccess:()=>{Y.visit(b.successUrl??"/dashboard")},onPending:()=>{Y.visit(b.pendingUrl??b.successUrl??"/dashboard")},onError:()=>{_?.add?.({title:"Pembayaran gagal",description:"Terjadi kesalahan saat memproses pembayaran Midtrans.",color:"error",icon:"i-lucide-x-circle"})},onClose:()=>{_?.add?.({title:"Pembayaran dibatalkan",description:"Kamu menutup popup pembayaran.",color:"warning",icon:"i-lucide-alert-circle"})}})}catch(n){const l=n instanceof Error?n.message:"Gagal membuka pembayaran Midtrans.";_?.add?.({title:"Bayar sekarang gagal",description:l,color:"error",icon:"i-lucide-x-circle"})}finally{$.value===String(s.id)&&($.value=null)}}}return{allOrders:v,hasMore:C,nextPage:S,isLoadingMore:O,checkingPaymentOrderId:z,payingOrderId:$,isDetailOpen:a,selectedOrder:o,q:i,status:y,sort:P,statusMeta:M,paymentMeta:N,statusItems:m,sortItems:T,filtered:q,totalCount:V,shownCount:te,detailItems:ae,formatCurrency:f,formatDateTime:x,reset:se,loadMore:G,openDetail:H,closeDetail:J,isOrderUnpaid:R,canPayNow:K,canDownloadInvoice:A,downloadInvoice:ie,checkPaymentStatus:ye,payNow:ve,normalizeImageUrl:X,shippingAddressLine:re}}const Me={class:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between"},De={class:"flex items-start gap-3"},Pe={class:"flex size-10 items-center justify-center rounded-2xl border border-default bg-elevated/60"},je={class:"min-w-0"},Te={class:"mt-0.5 text-xs text-muted"},Be={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-end"},Le=ee({__name:"OrdersFiltersBar",props:{shownCount:{},totalCount:{},q:{},status:{},sort:{},statusItems:{},sortItems:{}},emits:["update:q","update:status","update:sort","reset"],setup(t,{emit:_}){const d=t,v=_;function U(O){v("update:q",String(O??""))}function S(O){v("update:status",O)}function C(O){v("update:sort",O)}return(O,z)=>{const $=fe,a=Ie,o=$e,i=me;return c(),w("div",Me,[e("div",De,[e("div",Pe,[u($,{name:"i-lucide-package-search",class:"size-5 text-primary"})]),e("div",je,[z[1]||(z[1]=e("p",{class:"text-base font-semibold text-highlighted"},"Order",-1)),e("p",Te,p(t.shownCount)+" dari "+p(t.totalCount)+" pesanan ",1)])]),e("div",Be,[u(a,{"model-value":d.q,icon:"i-lucide-search",placeholder:"Cari kode, nama, resi...",size:"sm",class:"w-full sm:w-64","onUpdate:modelValue":U},null,8,["model-value"]),u(o,{"model-value":d.status,items:d.statusItems,"value-key":"value","label-key":"label",size:"sm",class:"w-full sm:w-44","onUpdate:modelValue":S},null,8,["model-value","items"]),u(o,{"model-value":d.sort,items:d.sortItems,"value-key":"value","label-key":"label",size:"sm",class:"w-full sm:w-44","onUpdate:modelValue":C},null,8,["model-value","items"]),d.q||d.status!=="all"||d.sort!=="newest"?(c(),I(i,{key:0,size:"sm",color:"neutral",variant:"ghost",icon:"i-lucide-rotate-ccw",onClick:z[0]||(z[0]=y=>v("reset"))},{default:g(()=>[...z[2]||(z[2]=[h(" Reset ",-1)])]),_:1})):k("",!0)])])}}}),Ne={key:0,class:"p-4 sm:p-6"},Ee={class:"grid gap-3"},qe={class:"flex items-start justify-between gap-3"},Re={class:"w-full space-y-2"},Ke={class:"mt-4 grid gap-2 sm:grid-cols-3"},Ae={key:2},Fe={class:"grid gap-3"},We={class:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between"},Ve={class:"min-w-0"},Ge={class:"flex flex-wrap items-center gap-2"},He={class:"text-sm font-extrabold text-highlighted"},Je={class:"mt-1 flex flex-wrap items-center gap-x-4 gap-y-1 text-xs text-muted"},Qe={class:"inline-flex items-center gap-1.5"},Xe={class:"inline-flex items-center gap-1.5"},Ye={key:0,class:"inline-flex items-center gap-1.5"},Ze={key:1,class:"inline-flex items-center gap-1.5"},et={class:"flex items-center justify-between sm:flex-col sm:items-end gap-2"},tt={class:"text-base font-black text-primary tabular-nums"},at={class:"flex flex-wrap items-center justify-end gap-2"},st={key:0,class:"mt-4"},nt={class:"mt-2 grid gap-2 sm:grid-cols-3"},it={class:"flex items-center gap-3"},lt={class:"size-10 shrink-0 overflow-hidden rounded-xl bg-elevated/40"},ot=["src","alt","onError"],rt={key:1,class:"flex h-full w-full items-center justify-center"},dt={class:"min-w-0 flex-1"},ct={class:"truncate text-sm font-semibold text-highlighted"},ut={class:"mt-0.5 truncate text-xs text-muted"},mt={key:0},ft={class:"font-semibold tabular-nums text-highlighted/80"},pt={class:"mt-4 flex items-center justify-between text-xs text-muted"},gt={class:"inline-flex items-center gap-1.5"},yt={class:"hidden sm:inline-flex items-center gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity"},vt={key:0,class:"inline-flex items-center gap-2.5 text-sm text-muted"},ht={key:1,class:"space-y-2"},xt=ee({__name:"OrdersListGrid",props:{loading:{type:Boolean,default:!1},allOrders:{},filtered:{},statusMeta:{},paymentMeta:{},isLoadingMore:{type:Boolean},hasMore:{type:Boolean},payingOrderId:{},checkingPaymentOrderId:{},formatDateTime:{},formatCurrency:{},normalizeImageUrl:{},isOrderUnpaid:{},canPayNow:{},canDownloadInvoice:{},downloadInvoice:{}},emits:["open-detail","pay-now","check-payment-status","load-more","reset"],setup(t,{emit:_}){const d=t,v=_,U=D(null),S=D(new Set);let C=null;function O(o,i){const y=d.normalizeImageUrl(i);return y?`${String(o)}::${y}`:null}function z(o,i){const y=O(o,i);return!y||S.value.has(y)?null:d.normalizeImageUrl(i)}function $(o,i){const y=O(o,i);!y||S.value.has(y)||(S.value=new Set([...S.value,y]))}function a(){C&&(C.disconnect(),U.value&&C.observe(U.value))}return be(()=>{C=new IntersectionObserver(o=>{o[0]?.isIntersecting&&v("load-more")},{rootMargin:"420px"}),a()}),W(U,()=>a()),W(()=>d.filtered.map(o=>`${o.id}:${o.items_preview?.length??0}`).join("|"),()=>{S.value=new Set}),ke(()=>{C?.disconnect(),C=null}),(o,i)=>{const y=Se,P=ue,M=me,N=ge,m=fe,T=pe;return d.loading&&d.allOrders.length===0?(c(),w("div",Ne,[e("div",Ee,[(c(),w(F,null,Z(4,f=>u(P,{key:f,class:"rounded-2xl",ui:{body:"p-4"}},{default:g(()=>[e("div",qe,[e("div",Re,[u(y,{class:"h-4 w-52"}),u(y,{class:"h-3 w-72"}),u(y,{class:"h-3 w-56"})]),u(y,{class:"h-7 w-24 rounded-xl"})]),e("div",Ke,[u(y,{class:"h-12 w-full rounded-2xl"}),u(y,{class:"h-12 w-full rounded-2xl"}),u(y,{class:"h-12 w-full rounded-2xl"})])]),_:1})),64))])])):d.filtered.length===0?(c(),I(N,{key:1,icon:"i-lucide-package-search",title:"Tidak ada pesanan ditemukan",description:"Coba ubah kata kunci atau filter.",variant:"outline",size:"lg",ui:{root:"rounded-2xl py-14"}},{actions:g(()=>[u(M,{size:"sm",color:"neutral",variant:"outline",icon:"i-lucide-rotate-ccw",onClick:i[0]||(i[0]=f=>v("reset"))},{default:g(()=>[...i[2]||(i[2]=[h(" Reset filter ",-1)])]),_:1})]),_:1})):(c(),w("div",Ae,[e("div",Fe,[(c(!0),w(F,null,Z(d.filtered,f=>(c(),I(P,{key:f.code,class:"rounded-xl overflow-hidden",ui:{root:"group relative hover:bg-elevated/30 transition-colors",body:"p-3 sm:p-3"}},{default:g(()=>[e("div",We,[e("div",Ve,[e("div",Ge,[e("p",He,"#"+p(f.code),1),u(T,{color:d.statusMeta[f.status]?.color,variant:"soft",size:"sm",class:"rounded-2xl"},{default:g(()=>[u(m,{name:d.statusMeta[f.status]?.icon,class:"mr-1 size-3.5"},null,8,["name"]),h(" "+p(d.statusMeta[f.status]?.label),1)]),_:2},1032,["color"]),f.payment_status?(c(),I(T,{key:0,color:d.paymentMeta[f.payment_status]?.color,variant:"subtle",size:"sm",class:"rounded-2xl"},{default:g(()=>[u(m,{name:d.paymentMeta[f.payment_status]?.icon,class:"mr-1 size-3.5"},null,8,["name"]),h(" "+p(d.paymentMeta[f.payment_status]?.label),1)]),_:2},1032,["color"])):k("",!0),f.tracking_number?(c(),I(T,{key:1,color:"neutral",variant:"subtle",size:"sm",class:"rounded-2xl"},{default:g(()=>[u(m,{name:"i-lucide-scan-line",class:"mr-1 size-3.5"}),h(" "+p(f.tracking_number),1)]),_:2},1024)):k("",!0)]),e("div",Je,[e("span",Qe,[u(m,{name:"i-lucide-calendar",class:"size-3.5"}),h(" "+p(d.formatDateTime(f.created_at)),1)]),e("span",Xe,[u(m,{name:"i-lucide-shopping-bag",class:"size-3.5"}),h(" "+p(f.items_count)+" item ",1)]),f.payment_method?(c(),w("span",Ye,[u(m,{name:"i-lucide-credit-card",class:"size-3.5"}),h(" "+p(f.payment_method),1)])):k("",!0),f.shipping_method?(c(),w("span",Ze,[u(m,{name:"i-lucide-truck",class:"size-3.5"}),h(" "+p(f.shipping_method),1)])):k("",!0)])]),e("div",et,[e("p",tt,p(d.formatCurrency(f.total)),1),e("div",at,[u(M,{size:"xs",color:"primary",variant:"soft",class:"rounded-2xl",icon:"i-lucide-eye",onClick:x=>v("open-detail",f)},{default:g(()=>[...i[3]||(i[3]=[h(" Detail ",-1)])]),_:1},8,["onClick"]),d.canDownloadInvoice(f)?(c(),I(M,{key:0,size:"xs",color:"neutral",variant:"outline",class:"rounded-2xl",icon:"i-lucide-file-down",onClick:x=>d.downloadInvoice(f)},{default:g(()=>[...i[4]||(i[4]=[h(" Invoice ",-1)])]),_:1},8,["onClick"])):k("",!0),d.canPayNow(f)?(c(),I(M,{key:1,size:"xs",color:"success",variant:"solid",class:"rounded-2xl",icon:"i-lucide-wallet",loading:d.payingOrderId===String(f.id),onClick:x=>v("pay-now",f)},{default:g(()=>[...i[5]||(i[5]=[h(" Bayar Sekarang ",-1)])]),_:1},8,["loading","onClick"])):k("",!0),d.isOrderUnpaid(f)?(c(),I(M,{key:2,size:"xs",color:"warning",variant:"outline",class:"rounded-2xl",icon:"i-lucide-refresh-cw",loading:d.checkingPaymentOrderId===String(f.id),onClick:x=>v("check-payment-status",f)},{default:g(()=>[...i[6]||(i[6]=[h(" Cek Status Bayar ",-1)])]),_:1},8,["loading","onClick"])):k("",!0),f.tracking_number?(c(),I(M,{key:3,size:"xs",color:"neutral",variant:"outline",class:"rounded-2xl",icon:"i-lucide-truck",onClick:x=>v("open-detail",f)},{default:g(()=>[...i[7]||(i[7]=[h(" Lacak ",-1)])]),_:1},8,["onClick"])):k("",!0)])])]),f.items_preview?.length?(c(),w("div",st,[i[9]||(i[9]=e("div",{class:"flex items-center justify-between"},[e("p",{class:"text-xs font-bold uppercase tracking-wider text-muted"},"Ringkasan item"),e("p",{class:"text-xs text-muted"},"Maks 3 ditampilkan")],-1)),e("div",nt,[(c(!0),w(F,null,Z(f.items_preview.slice(0,3),x=>(c(),I(P,{key:x.id,class:"rounded-2xl",ui:{body:"p-3"}},{default:g(()=>[e("div",it,[e("div",lt,[z(x.id,x.image)?(c(),w("img",{key:0,src:z(x.id,x.image)??void 0,alt:x.name,class:"h-full w-full object-cover",loading:"lazy",onError:q=>$(x.id,x.image)},null,40,ot)):(c(),w("div",rt,[u(m,{name:"i-lucide-image",class:"size-5 text-muted"})]))]),e("div",dt,[e("p",ct,p(x.name),1),e("p",ut,[x.variant?(c(),w("span",mt,p(x.variant)+" 路 ",1)):k("",!0),h("x"+p(x.qty)+" ",1),i[8]||(i[8]=e("span",{class:"mx-1"},"路",-1)),e("span",ft,p(d.formatCurrency(x.price)),1)])])])]),_:2},1024))),128))])])):k("",!0),e("div",pt,[e("span",gt,[u(m,{name:"i-lucide-user",class:"size-3.5"}),h(" "+p(f.customer?.name??"Guest"),1)]),e("span",yt,[u(m,{name:"i-lucide-mouse-pointer-click",class:"size-3.5"}),i[10]||(i[10]=h(" Klik detail untuk info lengkap ",-1))])])]),_:2},1024))),128))]),e("div",{ref_key:"sentinel",ref:U,class:"pt-8 text-center"},[d.isLoadingMore?(c(),w("div",vt,[u(m,{name:"i-lucide-loader-2",class:"size-4 animate-spin text-primary"}),i[11]||(i[11]=h(" Memuat pesanan... ",-1))])):d.hasMore?(c(),w("div",ht,[i[13]||(i[13]=e("p",{class:"text-xs text-muted"},"Scroll untuk memuat lebih banyak pesanan.",-1)),u(M,{size:"xs",color:"neutral",variant:"outline",onClick:i[1]||(i[1]=f=>v("load-more"))},{default:g(()=>[...i[12]||(i[12]=[h(" Muat lebih banyak ",-1)])]),_:1})])):(c(),I(T,{key:2,color:"neutral",variant:"subtle",class:"rounded-2xl"},{default:g(()=>[u(m,{name:"i-lucide-check-circle-2",class:"mr-1 size-3.5 text-emerald-500"}),i[14]||(i[14]=h(" Semua pesanan sudah dimuat ",-1))]),_:1}))],512)]))}}}),wt={key:0,class:"space-y-4"},bt={class:"flex flex-wrap items-center gap-2"},kt={class:"grid gap-3 sm:grid-cols-2"},_t={class:"mt-2 space-y-1.5 text-sm"},Ot={class:"flex items-center justify-between gap-3"},$t={class:"font-medium text-highlighted"},It={class:"flex items-center justify-between gap-3"},St={class:"font-medium text-highlighted"},Ct={class:"flex items-center justify-between gap-3"},zt={class:"font-medium text-highlighted"},Ut={class:"flex items-center justify-between gap-3"},Mt={class:"font-medium text-highlighted"},Dt={class:"mt-2 space-y-1.5 text-sm"},Pt={class:"flex items-center justify-between gap-3"},jt={class:"font-medium text-highlighted"},Tt={class:"flex items-center justify-between gap-3"},Bt={class:"font-medium text-highlighted"},Lt={class:"flex items-center justify-between gap-3"},Nt={class:"font-medium text-highlighted"},Et={class:"flex items-center justify-between gap-3"},qt={class:"font-medium text-highlighted"},Rt={class:"border-t border-default pt-2"},Kt={class:"flex items-center justify-between gap-3"},At={class:"font-black text-primary tabular-nums"},Ft={class:"mt-2 text-sm font-semibold text-highlighted"},Wt={class:"font-normal text-muted"},Vt={class:"mt-1 text-sm text-muted"},Gt={class:"flex items-center justify-between gap-3"},Ht={key:0,class:"mt-3 space-y-2"},Jt={class:"size-14 shrink-0 overflow-hidden rounded-lg bg-elevated/60"},Qt=["src","alt","onError"],Xt={key:1,class:"flex h-full w-full items-center justify-center"},Yt={class:"min-w-0 flex-1"},Zt={class:"truncate text-sm font-semibold text-highlighted"},ea={key:0,class:"truncate text-xs text-muted"},ta={class:"truncate text-xs text-muted"},aa={key:0},sa={class:"shrink-0 text-sm font-bold tabular-nums text-highlighted"},na={class:"mt-2 text-sm text-highlighted"},ia={class:"flex w-full flex-col-reverse gap-2 sm:flex-row sm:items-center sm:justify-between"},la={class:"flex flex-wrap items-center gap-2"},oa=ee({__name:"OrdersDetailModal",props:{open:{type:Boolean},selectedOrder:{default:null},detailItems:{},statusMeta:{},paymentMeta:{},checkingPaymentOrderId:{},payingOrderId:{},formatDateTime:{},formatCurrency:{},shippingAddressLine:{},normalizeImageUrl:{},isOrderUnpaid:{},canPayNow:{},canDownloadInvoice:{},downloadInvoice:{}},emits:["update:open","close","check-payment-status","pay-now"],setup(t,{emit:_}){const d=t,v=_,U=D(new Set);function S($,a){const o=d.normalizeImageUrl(a);return o?`${String($)}::${o}`:null}function C($,a){const o=S($,a);return!o||U.value.has(o)?null:d.normalizeImageUrl(a)}function O($,a){const o=S($,a);!o||U.value.has(o)||(U.value=new Set([...U.value,o]))}W(()=>d.selectedOrder?.id,()=>{U.value=new Set});function z(){v("close"),v("update:open",!1)}return($,a)=>{const o=fe,i=pe,y=ue,P=ge,M=me,N=Ce;return c(),I(N,{open:t.open,title:t.selectedOrder?`Detail Order #${t.selectedOrder.code}`:"Detail Order",description:"Ringkasan pembayaran, pengiriman, dan item order.",scrollable:"",content:{class:"w-[calc(100vw-1rem)] sm:max-w-4xl lg:max-w-5xl"},ui:{body:"max-h-[72vh] overflow-y-auto px-4 sm:px-6",footer:"px-4 sm:px-6 pb-4"},"onUpdate:open":a[3]||(a[3]=m=>v("update:open",m))},{body:g(()=>[t.selectedOrder?(c(),w("div",wt,[e("div",bt,[u(i,{color:t.statusMeta[t.selectedOrder.status]?.color,variant:"soft",class:"rounded-2xl"},{default:g(()=>[u(o,{name:t.statusMeta[t.selectedOrder.status]?.icon,class:"mr-1 size-3.5"},null,8,["name"]),h(" "+p(t.statusMeta[t.selectedOrder.status]?.label),1)]),_:1},8,["color"]),t.selectedOrder.payment_status?(c(),I(i,{key:0,color:t.paymentMeta[t.selectedOrder.payment_status]?.color,variant:"subtle",class:"rounded-2xl"},{default:g(()=>[u(o,{name:t.paymentMeta[t.selectedOrder.payment_status]?.icon,class:"mr-1 size-3.5"},null,8,["name"]),h(" "+p(t.paymentMeta[t.selectedOrder.payment_status]?.label),1)]),_:1},8,["color"])):k("",!0),t.selectedOrder.tracking_number?(c(),I(i,{key:1,color:"neutral",variant:"subtle",class:"rounded-2xl"},{default:g(()=>[u(o,{name:"i-lucide-scan-line",class:"mr-1 size-3.5"}),h(" "+p(t.selectedOrder.tracking_number),1)]),_:1})):k("",!0)]),e("div",kt,[u(y,{class:"rounded-2xl",ui:{root:"border border-default bg-elevated/20",body:"p-3"}},{default:g(()=>[a[8]||(a[8]=e("p",{class:"text-xs uppercase tracking-wider text-muted"},"Informasi Order",-1)),e("div",_t,[e("p",Ot,[a[4]||(a[4]=e("span",{class:"text-muted"},"Tanggal Order",-1)),e("span",$t,p(t.formatDateTime(t.selectedOrder.created_at)),1)]),e("p",It,[a[5]||(a[5]=e("span",{class:"text-muted"},"Dibayar Pada",-1)),e("span",St,p(t.formatDateTime(t.selectedOrder.paid_at)),1)]),e("p",Ct,[a[6]||(a[6]=e("span",{class:"text-muted"},"Metode Bayar",-1)),e("span",zt,p(t.selectedOrder.payment_method??"-"),1)]),e("p",Ut,[a[7]||(a[7]=e("span",{class:"text-muted"},"Kurir",-1)),e("span",Mt,p(t.selectedOrder.shipping_method??"-"),1)])])]),_:1}),u(y,{class:"rounded-2xl",ui:{root:"border border-default bg-elevated/20",body:"p-3"}},{default:g(()=>[a[14]||(a[14]=e("p",{class:"text-xs uppercase tracking-wider text-muted"},"Ringkasan Biaya",-1)),e("div",Dt,[e("p",Pt,[a[9]||(a[9]=e("span",{class:"text-muted"},"Subtotal",-1)),e("span",jt,p(t.formatCurrency(t.selectedOrder.subtotal??t.selectedOrder.total)),1)]),e("p",Tt,[a[10]||(a[10]=e("span",{class:"text-muted"},"Ongkir",-1)),e("span",Bt,p(t.formatCurrency(t.selectedOrder.shipping_cost??0)),1)]),e("p",Lt,[a[11]||(a[11]=e("span",{class:"text-muted"},"Pajak",-1)),e("span",Nt,p(t.formatCurrency(t.selectedOrder.tax_amount??0)),1)]),e("p",Et,[a[12]||(a[12]=e("span",{class:"text-muted"},"Diskon",-1)),e("span",qt,"-"+p(t.formatCurrency(t.selectedOrder.discount_amount??0)),1)]),e("div",Rt,[e("p",Kt,[a[13]||(a[13]=e("span",{class:"font-semibold text-highlighted"},"Total",-1)),e("span",At,p(t.formatCurrency(t.selectedOrder.total)),1)])])])]),_:1})]),t.selectedOrder.shipping_address?(c(),I(y,{key:0,class:"rounded-2xl",ui:{root:"border border-default bg-elevated/20",body:"p-3"}},{default:g(()=>[a[15]||(a[15]=e("p",{class:"text-xs uppercase tracking-wider text-muted"},"Alamat Pengiriman",-1)),e("p",Ft,[h(p(t.selectedOrder.shipping_address.recipient_name??"-")+" ",1),e("span",Wt,"路 "+p(t.selectedOrder.shipping_address.recipient_phone??"-"),1)]),e("p",Vt,p(t.shippingAddressLine(t.selectedOrder)),1)]),_:1})):k("",!0),u(y,{class:"rounded-2xl",ui:{root:"border border-default bg-elevated/20",body:"p-3"}},{default:g(()=>[e("div",Gt,[a[16]||(a[16]=e("p",{class:"text-xs uppercase tracking-wider text-muted"},"Item Order",-1)),u(i,{color:"neutral",variant:"subtle",class:"rounded-xl"},{default:g(()=>[h(p(t.detailItems.length)+" item ",1)]),_:1})]),t.detailItems.length?(c(),w("div",Ht,[(c(!0),w(F,null,Z(t.detailItems,m=>(c(),w("div",{key:m.id,class:"flex items-center gap-3 rounded-xl border border-default bg-default/10 p-2.5"},[e("div",Jt,[C(m.id,m.image)?(c(),w("img",{key:0,src:C(m.id,m.image)??void 0,alt:m.name,class:"h-full w-full object-cover",loading:"lazy",onError:T=>O(m.id,m.image)},null,40,Qt)):(c(),w("div",Xt,[u(o,{name:"i-lucide-image",class:"size-5 text-muted"})]))]),e("div",Yt,[e("p",Zt,p(m.name),1),m.sku?(c(),w("p",ea,"SKU: "+p(m.sku),1)):k("",!0),e("p",ta,[m.variant?(c(),w("span",aa,p(m.variant)+" 路 ",1)):k("",!0),h(" "+p(m.qty)+" x "+p(t.formatCurrency(m.price)),1)])]),e("p",sa,p(t.formatCurrency(m.row_total??m.price*m.qty)),1)]))),128))])):(c(),I(P,{key:1,icon:"i-lucide-shopping-bag",title:"Item order belum tersedia",description:"Data item tidak ditemukan pada order ini.",size:"sm",variant:"outline",ui:{root:"mt-3 rounded-xl py-8"}}))]),_:1}),t.selectedOrder.notes?(c(),I(y,{key:1,class:"rounded-2xl",ui:{root:"border border-default bg-elevated/20",body:"p-3"}},{default:g(()=>[a[17]||(a[17]=e("p",{class:"text-xs uppercase tracking-wider text-muted"},"Catatan Order",-1)),e("p",na,p(t.selectedOrder.notes),1)]),_:1})):k("",!0)])):k("",!0)]),footer:g(()=>[e("div",ia,[e("div",la,[u(M,{color:"neutral",variant:"outline",class:"rounded-xl",onClick:z},{default:g(()=>[...a[18]||(a[18]=[h(" Tutup ",-1)])]),_:1}),t.selectedOrder&&t.canDownloadInvoice(t.selectedOrder)?(c(),I(M,{key:0,color:"neutral",variant:"outline",class:"rounded-xl",icon:"i-lucide-file-down",onClick:a[0]||(a[0]=m=>t.downloadInvoice(t.selectedOrder))},{default:g(()=>[...a[19]||(a[19]=[h(" Download invoice ",-1)])]),_:1})):k("",!0),t.selectedOrder&&t.isOrderUnpaid(t.selectedOrder)?(c(),I(M,{key:1,color:"warning",variant:"solid",class:"rounded-xl",icon:"i-lucide-refresh-cw",loading:t.checkingPaymentOrderId===String(t.selectedOrder.id),onClick:a[1]||(a[1]=m=>v("check-payment-status",t.selectedOrder))},{default:g(()=>[...a[20]||(a[20]=[h(" Cek status pembayaran ",-1)])]),_:1},8,["loading"])):k("",!0)]),t.selectedOrder&&t.canPayNow(t.selectedOrder)?(c(),I(M,{key:0,color:"success",variant:"solid",class:"rounded-xl",icon:"i-lucide-wallet",loading:t.payingOrderId===String(t.selectedOrder.id),onClick:a[2]||(a[2]=m=>v("pay-now",t.selectedOrder))},{default:g(()=>[...a[21]||(a[21]=[h(" Bayar sekarang ",-1)])]),_:1},8,["loading"])):k("",!0)])]),_:1},8,["open","title"])}}}),Ca=ee({__name:"Orders",props:{orders:{default:()=>({data:[],current_page:1,next_page:null,has_more:!1,per_page:10,total:0})},midtrans:{default:()=>({env:"sandbox",client_key:""})},loading:{type:Boolean,default:!1}},setup(t){const _=t,{allOrders:d,hasMore:v,isLoadingMore:U,checkingPaymentOrderId:S,payingOrderId:C,isDetailOpen:O,selectedOrder:z,q:$,status:a,sort:o,statusMeta:i,paymentMeta:y,statusItems:P,sortItems:M,filtered:N,totalCount:m,shownCount:T,detailItems:f,formatCurrency:x,formatDateTime:q,reset:V,loadMore:te,openDetail:ae,closeDetail:se,isOrderUnpaid:G,canPayNow:H,canDownloadInvoice:J,downloadInvoice:R,checkPaymentStatus:Q,payNow:K,normalizeImageUrl:A,shippingAddressLine:ne}=Ue({orders:E(()=>_.orders),midtrans:E(()=>_.midtrans)});function ie(B){$.value=B}function le(B){a.value=B}function oe(B){o.value=B}return(B,X)=>{const re=ue;return c(),w(F,null,[u(re,{class:"rounded-3xl overflow-hidden"},{header:g(()=>[u(Le,{"shown-count":r(T),"total-count":r(m),q:r($),status:r(a),sort:r(o),"status-items":r(P),"sort-items":r(M),"onUpdate:q":ie,"onUpdate:status":le,"onUpdate:sort":oe,onReset:r(V)},null,8,["shown-count","total-count","q","status","sort","status-items","sort-items","onReset"])]),default:g(()=>[u(xt,{loading:t.loading,"all-orders":r(d),filtered:r(N),"status-meta":r(i),"payment-meta":r(y),"is-loading-more":r(U),"has-more":r(v),"paying-order-id":r(C),"checking-payment-order-id":r(S),"format-date-time":r(q),"format-currency":r(x),"normalize-image-url":r(A),"is-order-unpaid":r(G),"can-pay-now":r(H),"can-download-invoice":r(J),"download-invoice":r(R),onOpenDetail:r(ae),onPayNow:r(K),onCheckPaymentStatus:r(Q),onLoadMore:r(te),onReset:r(V)},null,8,["loading","all-orders","filtered","status-meta","payment-meta","is-loading-more","has-more","paying-order-id","checking-payment-order-id","format-date-time","format-currency","normalize-image-url","is-order-unpaid","can-pay-now","can-download-invoice","download-invoice","onOpenDetail","onPayNow","onCheckPaymentStatus","onLoadMore","onReset"])]),_:1}),u(oa,{open:r(O),"onUpdate:open":X[0]||(X[0]=de=>_e(O)?O.value=de:null),"selected-order":r(z),"detail-items":r(f),"status-meta":r(i),"payment-meta":r(y),"checking-payment-order-id":r(S),"paying-order-id":r(C),"format-date-time":r(q),"format-currency":r(x),"shipping-address-line":r(ne),"normalize-image-url":r(A),"is-order-unpaid":r(G),"can-pay-now":r(H),"can-download-invoice":r(J),"download-invoice":r(R),onClose:r(se),onCheckPaymentStatus:r(Q),onPayNow:r(K)},null,8,["open","selected-order","detail-items","status-meta","payment-meta","checking-payment-order-id","paying-order-id","format-date-time","format-currency","shipping-address-line","normalize-image-url","is-order-unpaid","can-pay-now","can-download-invoice","download-invoice","onClose","onCheckPaymentStatus","onPayNow"])],64)}}});export{Ca as default};
