import{_ as ue,a as ce,b as me}from"./PageHeader-DgwpZeqh.js";import{_ as Q}from"./Badge-BrOriF3i.js";import{a as pe}from"./AppLayout.vue_vue_type_script_setup_true_lang-CNOW6QX4.js";import{_ as Z}from"./Card-Bg0Kv25I.js";import{_ as re}from"./Icon-DLkENiec.js";import{c as E,p as le,d as X,b as O,e as b,k as p,F as J,l as se,f as e,t as m,g as i,i as u,j,u as l,q as ge,r as f,s as ye,w as F,h as M,v as z,x as A,a as Y}from"./app-Ct9AQz3a.js";import{_ as xe}from"./Select-CpEVedDT.js";import{_ as fe}from"./Textarea-DUxTFtHE.js";import{_ as be}from"./FormField-DR3qO_4n.js";import{_ as ke}from"./Input-DKYkVkaK.js";import{_ as oe}from"./Button-DlP5TfEn.js";import"./Presence-CTfVoSjs.js";import"./useLocale-QzNUJIp8.js";import"./usePortal-BjiTY23K.js";import"./VisuallyHidden-BSn5Ae5a.js";import"./utils-BSTWYaBh.js";import"./useToast-DVWuh0M_.js";import"./Separator-DbQt-yTr.js";import"./PopperArrow-q2Y0TQCy.js";import"./DialogTrigger-BCtGwlfO.js";import"./RovingFocusItem-8kWj2Je9.js";import"./Checkbox-CWKrCVZO.js";import"./VisuallyHiddenInput-DDhaMnhq.js";import"./Label-CSxIoeop.js";import"./clamp-BstbYvQo.js";function ne(){const s=le(),y=E(()=>s.props.items??[]),n=E(()=>s.props.cart??null),k=E(()=>s.props.addresses??[]),d=E(()=>s.props.saldo??0),x=E(()=>s.props.midtrans),V=E(()=>y.value.reduce((o,h)=>o+h.qty,0));function w(o){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(o)}return{items:y,cart:n,addresses:k,saldo:d,midtrans:x,itemCount:V,formatIDR:w}}const ve={class:"flex items-start justify-between gap-3"},he={key:0,class:"rounded-2xl border border-dashed border-gray-300 p-4 text-sm text-gray-600 dark:border-gray-700 dark:text-gray-300"},_e={key:1,class:"space-y-3"},we={class:"size-12 shrink-0 overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-900"},$e=["src","alt","onError"],Pe={key:1,class:"grid h-full w-full place-items-center"},Ce={class:"min-w-0 flex-1"},Ve={class:"truncate text-sm font-semibold text-gray-900 dark:text-white"},Se={key:0,class:"truncate text-xs text-gray-500 dark:text-gray-400"},Ue={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},je={class:"shrink-0 text-right"},Me={class:"whitespace-nowrap text-sm font-bold text-gray-900 dark:text-white"},Re={class:"flex items-center justify-between text-sm"},Ie={class:"font-semibold text-gray-900 dark:text-white"},De=X({__name:"CheckoutItemsList",props:{items:{},cart:{}},setup(s){const{formatIDR:y}=ne(),n=ge({});return(k,d)=>{const x=Q,V=re,w=Z;return u(),O(w,{class:"rounded-2xl"},{header:b(()=>[e("div",ve,[d[0]||(d[0]=e("div",null,[e("p",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Produk yang dibeli"),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Pastikan varian, jumlah, dan total sudah sesuai sebelum membayar. ")],-1)),i(x,{label:`${s.items.length} produk`,color:"neutral",variant:"soft",class:"rounded-full"},null,8,["label"])])]),footer:b(()=>[e("div",Re,[d[2]||(d[2]=e("span",{class:"text-gray-500 dark:text-gray-400"},"Total qty",-1)),e("span",Ie,m(s.items.reduce((o,h)=>o+h.qty,0))+" item ",1)])]),default:b(()=>[s.items.length===0?(u(),p("div",he," Tidak ada item untuk checkout. ")):(u(),p("div",_e,[(u(!0),p(J,null,se(s.items,o=>(u(),p("div",{key:o.id,class:"flex w-full items-center gap-3 rounded-2xl border border-gray-200 bg-white/70 p-3 backdrop-blur dark:border-gray-800 dark:bg-gray-950/40"},[e("div",we,[o.image&&!n[o.id]?(u(),p("img",{key:0,src:o.image,alt:o.name,class:"h-full w-full object-cover",onError:h=>n[o.id]=!0},null,40,$e)):(u(),p("div",Pe,[i(V,{name:"i-lucide-image",class:"size-5 text-gray-400"})]))]),e("div",Ce,[e("p",Ve,m(o.name),1),o.variant?(u(),p("p",Se,m(o.variant),1)):j("",!0),e("p",Ue,m(l(y)(o.price))+" × "+m(o.qty),1)]),e("div",je,[d[1]||(d[1]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Total",-1)),e("p",Me,m(l(y)(o.row_total)),1)])]))),128))]))]),_:1})}}});function Ee(s){const y=f(s.length?"saved":"manual"),n=f(null),k=f(""),d=f(""),x=f(""),V=f(""),w=f(""),o=f([]),h=f([]),c=f([]),a=f(""),g=f(""),_=f(""),v=f(!1),$=f(!1),U=f(!1),R=f([]),B=f(null),T=f(!1),C=f(null);ye(()=>{const t=s.find(P=>P.is_default)??s[0];t&&(n.value=t.id),H()});async function H(){v.value=!0;try{const t=await fetch("/checkout/shipping/provinces");if(!t.ok)return;o.value=await t.json()}catch{}finally{v.value=!1}}async function G(t){if(h.value=[],c.value=[],g.value="",_.value="",!!t){$.value=!0;try{const P=await fetch(`/checkout/shipping/cities?province=${encodeURIComponent(t)}`);if(!P.ok)return;h.value=await P.json()}catch{}finally{$.value=!1}}}async function D(t,P){if(c.value=[],_.value="",!(!t||!P)){U.value=!0;try{const q=`/checkout/shipping/districts?province=${encodeURIComponent(t)}&city=${encodeURIComponent(P)}`,K=await fetch(q);if(!K.ok)return;c.value=await K.json()}catch{}finally{U.value=!1}}}async function N(t,P,q){if(R.value=[],B.value=null,C.value=null,!(!t||!P)){T.value=!0;try{const K=new URLSearchParams({province:t,city:P});q&&K.set("district",q);const I=await fetch(`/checkout/shipping/cost?${K}`);if(!I.ok){const ee=await I.json().catch(()=>({}));C.value=ee?.message??"Tujuan pengiriman tidak tersedia.";return}R.value=await I.json()}catch{C.value="Gagal memuat tarif ongkir."}finally{T.value=!1}}}F(a,t=>{G(t)}),F(g,async t=>{t&&a.value?(await D(a.value,t),y.value==="manual"&&await N(a.value,t)):(R.value=[],B.value=null)}),F(_,t=>{y.value==="manual"&&a.value&&g.value&&N(a.value,g.value,t||void 0)}),F(n,t=>{if(y.value!=="saved"||!t)return;const P=s.find(q=>q.id===t);P?.province&&P?.city&&N(P.province,P.city)}),F(y,()=>{R.value=[],B.value=null,C.value=null});const S=E(()=>n.value?s.find(t=>t.id===n.value)??null:null),W=E(()=>y.value==="saved"?S.value?{address_mode:"saved",address_id:S.value.id}:null:{address_mode:"manual",recipient_name:k.value.trim(),phone:d.value.trim(),address_line:x.value.trim(),province:a.value,city:g.value,district:_.value.trim(),postal_code:V.value.trim(),notes:w.value.trim()}),L=E(()=>{if(y.value==="saved")return!!S.value;const t=W.value;return!t||t.address_mode!=="manual"?!1:!!(t.recipient_name&&t.phone&&t.address_line&&t.province&&t.city&&t.postal_code)});return{addressMode:y,selectedAddressId:n,selectedAddress:S,addressPayload:W,isAddressValid:L,recipientName:k,phone:d,addressLine:x,postalCode:V,notes:w,provinces:o,cities:h,districts:c,selectedProvince:a,selectedCity:g,selectedDistrict:_,isLoadingProvinces:v,isLoadingCities:$,isLoadingDistricts:U,shippingRates:R,selectedRate:B,isLoadingRates:T,shippingError:C}}const Ae={class:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between"},Be={class:"w-full sm:w-auto"},Le={class:"grid w-full grid-cols-2 rounded-2xl border border-gray-200 bg-white/70 p-1 backdrop-blur dark:border-gray-800 dark:bg-gray-950/40"},Ke={key:0,class:"space-y-3"},Te={key:0,class:"w-full rounded-2xl border border-dashed border-gray-300 p-4 text-sm text-gray-600 dark:border-gray-700 dark:text-gray-300"},qe={key:1,class:"grid w-full grid-cols-1 gap-3 sm:grid-cols-2"},ze=["onClick"],Fe={class:"flex items-start justify-between gap-2"},Ne={class:"min-w-0"},Oe={class:"truncate text-sm font-semibold text-gray-900 dark:text-white"},He={key:0,class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},Ge={class:"mt-1 truncate text-xs text-gray-500 dark:text-gray-400"},We={class:"mt-2 line-clamp-2 text-sm text-gray-700 dark:text-gray-200"},Je={key:0,class:"mt-1 line-clamp-1 text-xs text-gray-500 dark:text-gray-400"},Qe={class:"flex items-center justify-between"},Xe={key:1,class:"space-y-4"},Ye={class:"grid w-full grid-cols-1 gap-3 sm:grid-cols-2"},Ze={class:"grid w-full grid-cols-1 gap-3 sm:grid-cols-3"},et={class:"rounded-2xl border border-gray-200 bg-white/70 p-3 text-sm text-gray-600 backdrop-blur dark:border-gray-800 dark:bg-gray-950/40 dark:text-gray-300"},tt={class:"flex items-start gap-2"},at={key:2,class:"mt-4"},st={class:"flex items-center gap-2 rounded-2xl border border-gray-200 bg-white/70 p-4 backdrop-blur dark:border-gray-800 dark:bg-gray-950/40"},rt={key:3,class:"mt-4"},lt={class:"rounded-2xl border border-amber-200 bg-amber-50 p-3 text-sm text-amber-800 dark:border-amber-900/50 dark:bg-amber-950/40 dark:text-amber-200"},ot={class:"flex items-center gap-2"},nt={key:4,class:"mt-4 space-y-3"},it={class:"grid grid-cols-1 gap-2 sm:grid-cols-2"},dt=["onClick"],ut={class:"flex items-start justify-between gap-2"},ct={class:"min-w-0"},mt={class:"text-sm font-semibold text-gray-900 dark:text-white"},pt={class:"mt-0.5 text-xs text-gray-500 dark:text-gray-400"},gt={class:"flex shrink-0 items-center gap-1.5"},yt={class:"whitespace-nowrap text-sm font-bold text-gray-900 dark:text-white"},xt={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},ft={class:"text-sm text-gray-500 dark:text-gray-400"},bt={class:"text-xs text-gray-500 dark:text-gray-400"},kt={class:"font-semibold text-gray-900 dark:text-white"},vt={class:"font-semibold text-gray-900 dark:text-white"},ht=X({__name:"CheckoutAddressPanel",props:{addresses:{},shippingFee:{}},emits:["update:payload","update:isValid","update:rate"],setup(s,{emit:y}){const n=s,k=y,{addressMode:d,selectedAddressId:x,addressPayload:V,isAddressValid:w,recipientName:o,phone:h,addressLine:c,postalCode:a,notes:g,provinces:_,cities:v,districts:$,selectedProvince:U,selectedCity:R,selectedDistrict:B,isLoadingProvinces:T,isLoadingCities:C,isLoadingDistricts:H,shippingRates:G,selectedRate:D,isLoadingRates:N,shippingError:S}=Ee(n.addresses);F(V,L=>k("update:payload",L),{immediate:!0}),F(w,L=>k("update:isValid",L),{immediate:!0}),F(D,L=>k("update:rate",L),{immediate:!0});function W(L){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(L)}return(L,t)=>{const P=oe,q=Q,K=ke,I=be,ee=fe,te=xe,ae=re,ie=Z;return u(),O(ie,{class:"rounded-2xl"},{header:b(()=>[e("div",Ae,[t[12]||(t[12]=e("div",{class:"min-w-0"},[e("p",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Alamat Pengiriman"),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Pilih alamat tersimpan atau isi manual. Pastikan nomor HP aktif untuk kurir. ")],-1)),e("div",Be,[e("div",Le,[i(P,{class:"w-full rounded-xl",size:"sm",color:"neutral",variant:l(d)==="saved"?"solid":"ghost",onClick:t[0]||(t[0]=r=>d.value="saved")},{default:b(()=>[...t[10]||(t[10]=[M(" Pilih alamat ",-1)])]),_:1},8,["variant"]),i(P,{class:"w-full rounded-xl",size:"sm",color:"neutral",variant:l(d)==="manual"?"solid":"ghost",onClick:t[1]||(t[1]=r=>d.value="manual")},{default:b(()=>[...t[11]||(t[11]=[M(" Isi manual ",-1)])]),_:1},8,["variant"])])])])]),footer:b(()=>[e("div",xt,[e("div",ft,[t[18]||(t[18]=M(" Status alamat: ",-1)),e("span",{class:A(l(w)?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400")},m(l(w)?"Lengkap ✓":"Belum lengkap"),3)]),e("div",bt,[l(D)?(u(),p(J,{key:0},[t[19]||(t[19]=M(" Ongkir: ",-1)),e("span",kt,m(W(l(D).total_tariff)),1),M(" via "+m(l(D).product),1)],64)):(u(),p(J,{key:1},[t[20]||(t[20]=M(" Ongkir: ",-1)),e("span",vt,m(W(s.shippingFee)),1)],64))])])]),default:b(()=>[l(d)==="saved"?(u(),p("div",Ke,[s.addresses.length===0?(u(),p("div",Te,' Belum ada alamat tersimpan. Silakan pilih "Isi manual". ')):(u(),p("div",qe,[(u(!0),p(J,null,se(s.addresses,r=>(u(),p("button",{key:r.id,type:"button",class:A(["w-full rounded-2xl border p-4 text-left transition bg-white/70 backdrop-blur dark:bg-gray-950/40 hover:bg-white dark:hover:bg-gray-950/55",[l(x)===r.id?"border-primary-500 ring-2 ring-primary-500/20":"border-gray-200 dark:border-gray-800"]]),onClick:de=>x.value=r.id},[e("div",Fe,[e("div",Ne,[e("p",Oe,[M(m(r.label)+" ",1),r.is_default?(u(),p("span",He,"(Default)")):j("",!0)]),e("p",Ge,m(r.recipient_name)+" • "+m(r.phone),1)]),l(x)===r.id?(u(),O(q,{key:0,label:"Dipilih",color:"primary",variant:"soft",size:"xs",class:"shrink-0 rounded-full"})):j("",!0)]),e("p",We,m(r.address_line)+", "+m(r.city)+", "+m(r.province)+", "+m(r.postal_code),1),r.description?(u(),p("p",Je," Catatan: "+m(r.description),1)):j("",!0)],10,ze))),128))])),e("div",Qe,[t[14]||(t[14]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},' Tip: gunakan alamat "Default" untuk checkout lebih cepat. ',-1)),i(P,{to:"/dashboard",color:"neutral",variant:"ghost",class:"rounded-xl",size:"sm"},{default:b(()=>[...t[13]||(t[13]=[M(" Kelola alamat ",-1)])]),_:1})])])):(u(),p("div",Xe,[e("div",Ye,[i(I,{label:"Nama penerima",required:"",class:"w-full"},{default:b(()=>[i(K,{modelValue:l(o),"onUpdate:modelValue":t[2]||(t[2]=r=>z(o)?o.value=r:null),placeholder:"Nama lengkap",class:"w-full"},null,8,["modelValue"])]),_:1}),i(I,{label:"No. HP",required:"",class:"w-full"},{default:b(()=>[i(K,{modelValue:l(h),"onUpdate:modelValue":t[3]||(t[3]=r=>z(h)?h.value=r:null),placeholder:"08xxxxxxxxxx",class:"w-full"},null,8,["modelValue"])]),_:1})]),i(I,{label:"Alamat lengkap",required:"",class:"w-full"},{default:b(()=>[i(ee,{modelValue:l(c),"onUpdate:modelValue":t[4]||(t[4]=r=>z(c)?c.value=r:null),placeholder:"Jalan, RT/RW, nomor rumah, patokan...",rows:3,class:"w-full"},null,8,["modelValue"])]),_:1}),e("div",Ze,[i(I,{label:"Provinsi",required:"",class:"w-full"},{default:b(()=>[i(te,{modelValue:l(U),"onUpdate:modelValue":t[5]||(t[5]=r=>z(U)?U.value=r:null),items:l(_).map(r=>({label:r,value:r})),placeholder:"Pilih provinsi",loading:l(T),class:"w-full"},null,8,["modelValue","items","loading"])]),_:1}),i(I,{label:"Kota/Kab",required:"",class:"w-full"},{default:b(()=>[i(te,{modelValue:l(R),"onUpdate:modelValue":t[6]||(t[6]=r=>z(R)?R.value=r:null),items:l(v).map(r=>({label:r,value:r})),placeholder:"Pilih kota",loading:l(C),disabled:!l(U),class:"w-full"},null,8,["modelValue","items","loading","disabled"])]),_:1}),i(I,{label:"Kecamatan",class:"w-full"},{default:b(()=>[i(te,{modelValue:l(B),"onUpdate:modelValue":t[7]||(t[7]=r=>z(B)?B.value=r:null),items:l($).map(r=>({label:r,value:r})),placeholder:"Pilih kecamatan",loading:l(H),disabled:!l(R),class:"w-full"},null,8,["modelValue","items","loading","disabled"])]),_:1})]),i(I,{label:"Kode pos",required:"",class:"w-full sm:w-1/3"},{default:b(()=>[i(K,{modelValue:l(a),"onUpdate:modelValue":t[8]||(t[8]=r=>z(a)?a.value=r:null),placeholder:"12345",class:"w-full"},null,8,["modelValue"])]),_:1}),i(I,{label:"Catatan kurir (opsional)",class:"w-full"},{default:b(()=>[i(K,{modelValue:l(g),"onUpdate:modelValue":t[9]||(t[9]=r=>z(g)?g.value=r:null),placeholder:"Contoh: titip satpam / pagar hitam",class:"w-full"},null,8,["modelValue"])]),_:1}),e("div",et,[e("div",tt,[i(ae,{name:"i-lucide-info",class:"mt-0.5 size-4 text-gray-500 dark:text-gray-400"}),t[15]||(t[15]=e("div",{class:"min-w-0"},[e("p",{class:"font-semibold text-gray-900 dark:text-white"},"Panduan singkat"),e("ul",{class:"mt-1 list-disc space-y-1 pl-5"},[e("li",null,"Masukkan alamat sedetail mungkin (RT/RW dan patokan membantu kurir)."),e("li",null,"Nomor HP dipakai untuk konfirmasi pengantaran.")])],-1))])])])),l(N)?(u(),p("div",at,[e("div",st,[i(ae,{name:"i-lucide-loader-circle",class:"size-4 animate-spin text-gray-400"}),t[16]||(t[16]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"Memuat tarif ongkir Lion Parcel…",-1))])])):l(S)?(u(),p("div",rt,[e("div",lt,[e("div",ot,[i(ae,{name:"i-lucide-triangle-alert",class:"size-4 shrink-0"}),M(" "+m(l(S)),1)])])])):l(G).length>0?(u(),p("div",nt,[t[17]||(t[17]=e("p",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Layanan Pengiriman (Lion Parcel)",-1)),e("div",it,[(u(!0),p(J,null,se(l(G),r=>(u(),p("button",{key:r.product,type:"button",class:A(["w-full rounded-2xl border p-3 text-left transition bg-white/70 backdrop-blur dark:bg-gray-950/40 hover:bg-white dark:hover:bg-gray-950/55",[l(D)?.product===r.product?"border-primary-500 ring-2 ring-primary-500/20":"border-gray-200 dark:border-gray-800"]]),onClick:de=>D.value=r},[e("div",ut,[e("div",ct,[e("p",mt,m(r.product),1),e("p",pt,m(r.estimasi_sla),1)]),e("div",gt,[e("p",yt,m(W(r.total_tariff)),1),l(D)?.product===r.product?(u(),O(q,{key:0,label:"Dipilih",color:"primary",variant:"soft",size:"xs",class:"rounded-full"})):j("",!0)])])],10,dt))),128))])])):j("",!0)]),_:1})}}}),_t={class:"space-y-3"},wt={class:"grid w-full grid-cols-1 gap-3 sm:grid-cols-2"},$t=["disabled"],Pt={class:"flex items-start justify-between gap-2"},Ct={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Vt={class:"font-semibold"},St={class:"flex shrink-0 items-center gap-1.5"},Ut={key:0,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},jt=["disabled"],Mt={class:"flex items-start justify-between gap-2"},Rt={class:"flex shrink-0 items-center gap-1.5"},It={key:0,class:"rounded-2xl border border-amber-200 bg-amber-50 p-3 text-sm text-amber-800 dark:border-amber-900/50 dark:bg-amber-950/40 dark:text-amber-200"},Dt={class:"rounded-2xl border border-gray-200 bg-white/70 p-3 text-sm text-gray-600 backdrop-blur dark:border-gray-800 dark:bg-gray-950/40 dark:text-gray-300"},Et={class:"flex items-start gap-2"},At=X({__name:"CheckoutPaymentPanel",props:{saldo:{},total:{},midtransClientKey:{},modelValue:{}},emits:["update:modelValue"],setup(s,{emit:y}){const n=s,k=y;function d(w){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(w)}const x=()=>n.saldo>=n.total,V=()=>Math.max(0,n.total-n.saldo);return(w,o)=>{const h=re,c=Q,a=Z;return u(),O(a,{class:"rounded-2xl"},{header:b(()=>[...o[2]||(o[2]=[e("div",null,[e("p",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Metode Pembayaran"),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Pilih metode pembayaran. Saldo hanya bisa dipilih jika mencukupi total. ")],-1)])]),default:b(()=>[e("div",_t,[e("div",wt,[e("button",{type:"button",class:A(["w-full rounded-2xl border p-4 text-left transition bg-white/70 backdrop-blur dark:bg-gray-950/40",[x()?"hover:bg-white dark:hover:bg-gray-950/55":"cursor-not-allowed opacity-60",s.modelValue==="saldo"?"border-primary-500 ring-2 ring-primary-500/20":"border-gray-200 dark:border-gray-800"]]),disabled:!x(),onClick:o[0]||(o[0]=g=>x()&&k("update:modelValue","saldo"))},[e("div",Pt,[e("div",null,[o[4]||(o[4]=e("p",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Saldo Ewallet",-1)),e("p",Ct,[o[3]||(o[3]=M(" Saldo: ",-1)),e("span",Vt,m(d(s.saldo)),1)])]),e("div",St,[i(h,{name:"i-lucide-wallet",class:"size-4 text-gray-500 dark:text-gray-400"}),i(c,{label:x()?"Cukup":"Saldo kurang",color:x()?"success":"warning",variant:"soft",size:"xs",class:"rounded-full"},null,8,["label","color"])])]),x()?j("",!0):(u(),p("p",Ut," Kurang "+m(d(V())),1))],10,$t),e("button",{type:"button",class:A(["w-full rounded-2xl border p-4 text-left transition bg-white/70 backdrop-blur dark:bg-gray-950/40 hover:bg-white dark:hover:bg-gray-950/55",[s.modelValue==="midtrans"?"border-primary-500 ring-2 ring-primary-500/20":"border-gray-200 dark:border-gray-800",s.midtransClientKey?"":"cursor-not-allowed opacity-60"]]),disabled:!s.midtransClientKey,onClick:o[1]||(o[1]=g=>s.midtransClientKey&&k("update:modelValue","midtrans"))},[e("div",Mt,[o[5]||(o[5]=e("div",null,[e("p",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Midtrans"),e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," GoPay, ShopeePay, Transfer, Kartu Kredit & lebih ")],-1)),e("div",Rt,[i(h,{name:"i-lucide-credit-card",class:"size-4 text-gray-500 dark:text-gray-400"}),i(c,{label:"Snap",color:"primary",variant:"soft",size:"xs",class:"rounded-full"})])])],10,jt)]),s.midtransClientKey?j("",!0):(u(),p("div",It," Midtrans clientKey belum tersedia. Hubungi admin untuk mengaktifkan metode ini. ")),e("div",Dt,[e("div",Et,[i(h,{name:"i-lucide-shield-check",class:"mt-0.5 size-4 text-gray-500 dark:text-gray-400"}),o[6]||(o[6]=e("div",{class:"min-w-0"},[e("p",{class:"font-semibold text-gray-900 dark:text-white"},"Aman & terlindungi"),e("ul",{class:"mt-1 list-disc space-y-1 pl-5"},[e("li",null,"Saldo ewallet langsung dipotong saat transaksi berhasil."),e("li",null,"Midtrans Snap menampilkan popup pembayaran yang aman.")])],-1))])])])]),_:1})}}}),Bt={class:"lg:sticky lg:top-24 space-y-4"},Lt={class:"flex items-start justify-between gap-2"},Kt={class:"space-y-3"},Tt={class:"rounded-2xl border border-gray-200 bg-white/70 p-3 backdrop-blur dark:border-gray-800 dark:bg-gray-950/40"},qt={class:"mt-2 grid grid-cols-2 gap-2"},zt={class:"flex items-center justify-between text-sm"},Ft={class:"font-semibold text-gray-900 dark:text-white"},Nt={key:0,class:"flex items-center justify-between text-sm"},Ot={class:"font-semibold text-emerald-600 dark:text-emerald-400"},Ht={class:"flex items-center justify-between text-sm"},Gt={class:"font-semibold text-gray-900 dark:text-white"},Wt={class:"flex items-center justify-between text-sm"},Jt={class:"text-gray-600 dark:text-gray-300"},Qt={key:0,class:"text-xs text-gray-400 dark:text-gray-500"},Xt={class:"font-semibold text-gray-900 dark:text-white"},Yt={class:"flex items-center justify-between"},Zt={class:"whitespace-nowrap text-lg font-extrabold text-gray-900 dark:text-white"},ea={key:1,class:"rounded-2xl border border-gray-200 bg-white/70 p-3 backdrop-blur dark:border-gray-800 dark:bg-gray-950/40"},ta={class:"mt-1 text-sm font-semibold text-gray-900 dark:text-white"},aa={key:0,class:"ml-2 text-xs font-medium text-rose-600 dark:text-rose-400"},sa={class:"rounded-2xl border border-gray-200 bg-white/70 p-3 text-xs text-gray-600 backdrop-blur dark:border-gray-800 dark:bg-gray-950/40 dark:text-gray-300"},ra={class:"mt-1 list-disc space-y-1 pl-5"},la={key:2,class:"rounded-2xl border border-rose-200 bg-rose-50 p-3 text-sm text-rose-700 dark:border-rose-900/50 dark:bg-rose-950/40 dark:text-rose-200"},oa={class:"text-xs text-gray-500 dark:text-gray-400"},na=X({__name:"CheckoutSummary",props:{cart:{},saldo:{},selectedPlan:{},selectedMethod:{},selectedRate:{},isAddressValid:{type:Boolean},isSubmitting:{type:Boolean},errorMessage:{},midtransEnv:{},shippingCost:{},total:{}},emits:["pay","update:selectedPlan"],setup(s,{emit:y}){const n=s,k=y;function d(c){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(c)}function x(c){c!==n.selectedPlan&&k("update:selectedPlan",c)}function V(c){return n.selectedPlan===c?"border-primary-500 bg-primary-50 text-primary-700 dark:border-primary-500/70 dark:bg-primary-950/40 dark:text-primary-300":"border-gray-200 bg-white text-gray-700 hover:border-gray-300 dark:border-gray-800 dark:bg-gray-950/40 dark:text-gray-300 dark:hover:border-gray-700"}const w=()=>n.selectedMethod==="saldo"&&n.saldo>=n.total,o=()=>n.selectedMethod?n.selectedMethod==="saldo"?w():!0:!1,h=()=>!!(n.cart&&n.total>0&&n.isAddressValid&&o()&&!n.isSubmitting);return(c,a)=>{const g=Q,_=oe,v=Z;return u(),p("div",Bt,[i(v,{class:"rounded-2xl"},{header:b(()=>[e("div",Lt,[a[3]||(a[3]=e("div",null,[e("p",{class:"text-base font-semibold text-gray-900 dark:text-white"},"Ringkasan Pembayaran"),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Total dihitung otomatis dari keranjang. ")],-1)),s.midtransEnv==="sandbox"?(u(),O(g,{key:0,label:"Sandbox",color:"warning",variant:"soft",class:"rounded-full shrink-0"})):j("",!0)])]),default:b(()=>[e("div",Kt,[e("div",Tt,[a[6]||(a[6]=e("p",{class:"text-xs font-semibold text-gray-900 dark:text-white"},"Tipe Plan Order",-1)),a[7]||(a[7]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Pilih plan yang akan disimpan pada transaksi order. ",-1)),e("div",qt,[e("button",{type:"button",class:A(["rounded-xl border px-3 py-2 text-left transition-colors",V("planA")]),onClick:a[0]||(a[0]=$=>x("planA"))},[...a[4]||(a[4]=[e("p",{class:"text-sm font-semibold"},"Plan A",-1),e("p",{class:"text-xs opacity-80"},"Default order",-1)])],2),e("button",{type:"button",class:A(["rounded-xl border px-3 py-2 text-left transition-colors",V("planB")]),onClick:a[1]||(a[1]=$=>x("planB"))},[...a[5]||(a[5]=[e("p",{class:"text-sm font-semibold"},"Plan B",-1),e("p",{class:"text-xs opacity-80"},"Alternatif plan",-1)])],2)])]),e("div",zt,[a[8]||(a[8]=e("span",{class:"text-gray-600 dark:text-gray-300"},"Subtotal",-1)),e("span",Ft,m(d(s.cart?.subtotal??0)),1)]),s.cart&&s.cart.discount>0?(u(),p("div",Nt,[a[9]||(a[9]=e("span",{class:"text-gray-600 dark:text-gray-300"},"Diskon",-1)),e("span",Ot," -"+m(d(s.cart.discount)),1)])):j("",!0),e("div",Ht,[a[10]||(a[10]=e("span",{class:"text-gray-600 dark:text-gray-300"},"Pajak",-1)),e("span",Gt,m(d(s.cart?.tax??0)),1)]),e("div",Wt,[e("span",Jt,[a[11]||(a[11]=M(" Ongkir ",-1)),s.selectedRate?(u(),p("span",Qt," ("+m(s.selectedRate.product)+") ",1)):j("",!0)]),e("span",Xt,m(d(s.shippingCost)),1)]),a[16]||(a[16]=e("div",{class:"my-1 border-t border-gray-200 dark:border-gray-800"},null,-1)),e("div",Yt,[a[12]||(a[12]=e("span",{class:"text-sm font-semibold text-gray-900 dark:text-white"},"Total",-1)),e("span",Zt,m(d(s.total)),1)]),s.selectedMethod==="saldo"?(u(),p("div",ea,[a[13]||(a[13]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"Saldo Ewallet",-1)),e("p",ta,[M(m(d(s.saldo))+" ",1),w()?j("",!0):(u(),p("span",aa," (Kurang "+m(d(s.total-s.saldo))+") ",1))])])):j("",!0),e("div",sa,[a[14]||(a[14]=e("p",{class:"font-semibold text-gray-900 dark:text-white"},"Checklist sebelum bayar",-1)),e("ul",ra,[e("li",{class:A(s.isAddressValid?"text-emerald-600 dark:text-emerald-400":"")}," Alamat pengiriman lengkap ",2),e("li",{class:A(s.selectedRate?"text-emerald-600 dark:text-emerald-400":"")}," Layanan pengiriman dipilih ",2),e("li",{class:A(s.selectedMethod?"text-emerald-600 dark:text-emerald-400":"")}," Metode pembayaran dipilih ",2),e("li",{class:A(o()?"text-emerald-600 dark:text-emerald-400":"")},m(s.selectedMethod==="saldo"?"Saldo mencukupi total":"Siap membayar via Midtrans"),3)])]),s.errorMessage?(u(),p("div",la,m(s.errorMessage),1)):j("",!0),i(_,{color:"primary",variant:"solid",class:"rounded-xl",size:"lg",block:"",disabled:!h(),loading:s.isSubmitting,onClick:a[2]||(a[2]=$=>k("pay"))},{default:b(()=>[M(m(s.isSubmitting?"Memproses…":"Bayar Sekarang"),1)]),_:1},8,["disabled","loading"]),e("p",oa,m(s.selectedMethod==="midtrans"?"Kamu akan diarahkan ke popup Midtrans Snap.":"Saldo akan dipotong langsung."),1),i(_,{to:"/cart",color:"neutral",variant:"outline",class:"rounded-xl",block:""},{default:b(()=>[...a[15]||(a[15]=[M(" Kembali ke Keranjang ",-1)])]),_:1})])]),_:1})])}}});function ia(s){const y=Object.values(s).find(n=>n!==void 0);return Array.isArray(y)?y[0]??"Validasi gagal.":y??"Validasi gagal."}function da(s,y){const n=le(),k=f(!1),d=f(null);function x(){return`${s==="production"?"https://app.midtrans.com":"https://app.sandbox.midtrans.com"}/snap/snap.js`}async function V(){return window.snap?.pay?!0:y?new Promise(c=>{const a=document.querySelector('script[data-midtrans-snap="1"]');if(a){a.addEventListener("load",()=>c(!!window.snap?.pay)),a.addEventListener("error",()=>c(!1));return}const g=document.createElement("script");g.src=x(),g.async=!0,g.setAttribute("data-midtrans-snap","1"),g.setAttribute("data-client-key",y),g.onload=()=>c(!!window.snap?.pay),g.onerror=()=>c(!1),document.head.appendChild(g)}):!1}async function w(c,a){const g=String(n.props.csrf_token??"");return new Promise((_,v)=>{Y.post(c,{_token:g,...a},{only:["flash","errors"],preserveState:!0,preserveScroll:!0,replace:!0,onSuccess:$=>{const U=$?.props??{};_(U)},onError:$=>{v(new Error(ia($)))},onCancel:()=>{v(new Error("Request dibatalkan."))}})})}async function o(c){d.value=null,k.value=!0;try{const _=(await w("/checkout/midtrans/token",typeof c=="object"&&c!==null?c:{})).flash?.checkout,v=_?.payload??{},$=v.snapToken;if(!$)throw new Error(_?.message??"Snap token tidak ditemukan dari server.");if(!await V())throw new Error("Midtrans Snap gagal dimuat. Pastikan clientKey benar.");k.value=!1,window.snap?.pay($,{onSuccess:()=>{Y.visit(v.successUrl??"/dashboard")},onPending:()=>{Y.visit(v.pendingUrl??v.successUrl??"/dashboard")},onError:()=>{d.value="Pembayaran gagal. Silakan coba lagi."},onClose:()=>{d.value="Pembayaran dibatalkan."}})}catch(a){d.value=a instanceof Error?a.message:"Terjadi kesalahan saat memproses pembayaran."}finally{k.value&&(k.value=!1)}}async function h(c){d.value=null,k.value=!0;try{const v=(await w("/checkout/pay/saldo",typeof c=="object"&&c!==null?c:{})).flash?.checkout?.payload??{};Y.visit(v.redirectTo??"/dashboard")}catch(a){d.value=a instanceof Error?a.message:"Terjadi kesalahan saat memproses pembayaran."}finally{k.value=!1}}return{isSubmitting:k,errorMessage:d,payViaMidtrans:o,payViaSaldo:h}}const ua={class:"mx-auto max-w-screen-2xl px-4 sm:px-6 lg:px-8 mt-8"},ca={class:"flex items-center gap-2"},ma={class:"grid grid-cols-1 gap-5 lg:grid-cols-12"},pa={class:"space-y-5 lg:col-span-8"},ga={class:"lg:col-span-4"},Ta=X({layout:pe,__name:"Index",setup(s){const{items:y,cart:n,addresses:k,saldo:d,midtrans:x,itemCount:V}=ne(),{isSubmitting:w,errorMessage:o,payViaMidtrans:h,payViaSaldo:c}=da(x.value.env,x.value.client_key),a=f(null),g=f(!1),_=f(null),v=f(null),$=f("planA"),U=E(()=>_.value?.total_tariff??n.value?.shipping??0),R=E(()=>(n.value?.subtotal??0)+U.value+(n.value?.tax??0)-(n.value?.discount??0));async function B(){if(!a.value||!v.value)return;const T={...a.value,order_type:$.value,shipping_service_code:_.value?.product??"",shipping_cost:U.value,shipping_etd:_.value?.estimasi_sla??""};v.value==="saldo"?await c(T):await h(T)}return(T,C)=>{const H=Q,G=ue,D=ce,N=me;return u(),p("div",ua,[i(N,{class:"min-h-screen bg-gray-50/60 dark:bg-gray-950 transition-colors duration-300"},{default:b(()=>[i(G,{class:"p-5",title:"Checkout",description:"Alamat → Pembayaran → Konfirmasi"},{right:b(()=>[e("div",ca,[l(x).env==="sandbox"?(u(),O(H,{key:0,label:"Sandbox",color:"warning",variant:"soft",class:"rounded-full"})):j("",!0),i(H,{label:`${l(V)} item`,color:"neutral",variant:"soft",class:"rounded-full"},null,8,["label"])])]),_:1}),i(D,{class:"p-5"},{default:b(()=>[e("div",ma,[e("div",pa,[i(ht,{addresses:l(k),"shipping-fee":l(n)?.shipping??0,"onUpdate:payload":C[0]||(C[0]=S=>a.value=S),"onUpdate:isValid":C[1]||(C[1]=S=>g.value=S),"onUpdate:rate":C[2]||(C[2]=S=>_.value=S)},null,8,["addresses","shipping-fee"]),i(De,{items:l(y),cart:l(n)},null,8,["items","cart"]),i(At,{saldo:l(d),total:R.value,"midtrans-client-key":l(x).client_key,"model-value":v.value,"onUpdate:modelValue":C[3]||(C[3]=S=>v.value=S)},null,8,["saldo","total","midtrans-client-key","model-value"])]),e("div",ga,[i(na,{cart:l(n),saldo:l(d),"selected-plan":$.value,"selected-method":v.value,"selected-rate":_.value,"is-address-valid":g.value,"is-submitting":l(w),"error-message":l(o),"midtrans-env":l(x).env,"shipping-cost":U.value,total:R.value,"onUpdate:selectedPlan":C[4]||(C[4]=S=>$.value=S),onPay:B},null,8,["cart","saldo","selected-plan","selected-method","selected-rate","is-address-valid","is-submitting","error-message","midtrans-env","shipping-cost","total"])])])]),_:1})]),_:1})])}}});export{Ta as default};
